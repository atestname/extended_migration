% read data
[data,SuTraceHeaders,SuHeader]=ReadSu('data_ex3.su');

% source and receiver coordinates per trace
for k=1:length(SuTraceHeaders)
    xs(k)= SuTraceHeaders(k).SourceX;
    xr(k)= SuTraceHeaders(k).GroupX;
end

% note that the sample interval is given in miliseconds!
t = [0:SuHeader.ns-1]'*SuHeader.dt*1e-6;

% source and receiver coordinate vectors
xs = unique(xs);
xr = unique(xr);

% reshape data into cube
data = reshape(data,length(t),length(xr),length(xs));

% window and subsample
data(1:100,:,:) = 0;
data = data(:,1:10:end,:);
xr = xs;

% % if even number occur in fourier transform
% data(end,:,:) = [];
% data(:,end,:) = [];
% data(:,:,end) = [];
% t(end) = [];
% xs(end) = [];
% xr(end) = [];


% image using Tristan's code
z      = 0:10:1000;
v      = 2000 + 0 * z;
image1 = DSR_mig(data,t,xr,xs,z,v(1:length(z)));

figure;imagesc(image1); 


% imaging with DSR_mig_spot


% imaging with opDSRmig
dim = size(data);
x = xr; y = xs;
K = opDSRmig(dim,t,x,y,z,v);
Kdata = K*vec(data);
image2 = reshape(Kdata,length(z),length(xr));
figure;imagesc(image2); 



% % image using Lina's code
% 
% image2 = my_mig(data,t,xr,z,v+0*z,2);
% 
% figure;imagesc(real(image2));